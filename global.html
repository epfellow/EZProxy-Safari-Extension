<!DOCTYPE html>
<html>
<head>
	<title>EZ Proxy</title>
	<script type="text/javascript" charset="utf-8">



function performCommand(event)
{
	if (event.command === "loadEZ") {
		var taburl = safari.application.activeBrowserWindow.activeTab.url;
		var ezurl = safari.extension.settings.ezproxyurl;

		if (ezurl.indexOf("$@") >= 0) {
			var newurl = ezurl.replace("$@", taburl);
		}
		var currentTab = safari.application.activeBrowserWindow.activeTab
		currentTab.url = newurl;
 }
}

function validateCommand(event)
{
    if (event.command === "loadEZ") {
        // Disable the button if there is no URL loaded in the tab.
        event.target.disabled = !event.target.browserWindow.activeTab.url;
    }
}

// if event handlers are in the global HTML page,
// register with application:
safari.application.addEventListener("command", performCommand, true);
safari.application.addEventListener("validate", validateCommand, true);
</script>
</head>
<body>
</body>
</html>

